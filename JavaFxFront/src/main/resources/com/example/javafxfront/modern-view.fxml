<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.example.javafxfront.ModernController">
    <center>
        <ScrollPane fitToWidth="true" fitToHeight="true" styleClass="scroll-pane">
            <VBox alignment="TOP_CENTER" spacing="30.0" styleClass="main-container">
                <padding>
                    <Insets bottom="40.0" left="40.0" right="40.0" top="40.0" />
                </padding>

                <!-- Header Section -->
                <VBox alignment="CENTER" spacing="10.0" styleClass="header-section">
                    <Label fx:id="titleLabel" styleClass="title-label" text="Witamy w dzienniku online">
                        <font>
                            <Font name="System Bold" size="32.0" />
                        </font>
                    </Label>
                    <Label fx:id="subtitleLabel" styleClass="subtitle-label" text="Zarządzanie grupami studenckimi">
                        <font>
                            <Font size="16.0" />
                        </font>
                    </Label>
                </VBox>

                <!-- Main Content -->
                <HBox alignment="TOP_CENTER" spacing="20.0" styleClass="content-container">

                    <!-- Add Group Card -->
                    <VBox fx:id="addGroupCard" alignment="TOP_CENTER" spacing="20.0" styleClass="main-card" maxWidth="300.0" minWidth="280.0">
                        <padding>
                            <Insets bottom="25.0" left="25.0" right="25.0" top="25.0" />
                        </padding>

                        <Label styleClass="card-title" text="Dodaj nową grupę">
                            <font>
                                <Font name="System Bold" size="16.0" />
                            </font>
                        </Label>

                        <VBox spacing="15.0" styleClass="form-container">
                            <VBox spacing="5.0">
                                <Label styleClass="field-label" text="Nazwa grupy:">
                                    <font>
                                        <Font name="System Bold" size="11.0" />
                                    </font>
                                </Label>
                                <TextField fx:id="groupNameField" promptText="np. Grupa INF-A" styleClass="modern-field" />
                            </VBox>

                            <VBox spacing="5.0">
                                <Label styleClass="field-label" text="Specjalizacja:">
                                    <font>
                                        <Font name="System Bold" size="11.0" />
                                    </font>
                                </Label>
                                <TextField fx:id="specializationField" promptText="np. Informatyka" styleClass="modern-field" />
                            </VBox>
                        </VBox>

                        <Button fx:id="addGroupButton" mnemonicParsing="false" onAction="#onAddGroupClick"
                                styleClass="primary-button" text="Dodaj grupę" maxWidth="Infinity" />
                    </VBox>

                    <!-- Add Student Card -->
                    <VBox fx:id="addStudentCard" alignment="TOP_CENTER" spacing="20.0" styleClass="main-card" maxWidth="300.0" minWidth="280.0">
                        <padding>
                            <Insets bottom="25.0" left="25.0" right="25.0" top="25.0" />
                        </padding>

                        <HBox alignment="CENTER_LEFT" spacing="10.0">
                            <Label styleClass="card-title" text="Dodaj studenta">
                                <font>
                                    <Font name="System Bold" size="16.0" />
                                </font>
                            </Label>
                            <Region HBox.hgrow="ALWAYS" />
                            <!-- DODANE - Przycisk odświeżania licznika studentów -->
                            <Button fx:id="refreshStudentsGlobalButton" mnemonicParsing="false" onAction="#onRefreshStudentsGlobalClick"
                                    styleClass="secondary-button" text="🔄" />
                        </HBox>

                        <!-- DODANE - Licznik studentów na serwerze -->
                        <Label fx:id="studentCountLabel" styleClass="count-label" text="Ładowanie liczby studentów...">
                            <font>
                                <Font size="10.0" />
                            </font>
                        </Label>

                        <VBox spacing="15.0" styleClass="form-container">
                            <VBox spacing="5.0">
                                <Label styleClass="field-label" text="Imię:">
                                    <font>
                                        <Font name="System Bold" size="11.0" />
                                    </font>
                                </Label>
                                <TextField fx:id="studentFirstNameField" promptText="Imię studenta" styleClass="modern-field" />
                            </VBox>

                            <VBox spacing="5.0">
                                <Label styleClass="field-label" text="Nazwisko:">
                                    <font>
                                        <Font name="System Bold" size="11.0" />
                                    </font>
                                </Label>
                                <TextField fx:id="studentLastNameField" promptText="Nazwisko studenta" styleClass="modern-field" />
                            </VBox>

                            <VBox spacing="5.0">
                                <Label styleClass="field-label" text="Nr indeksu:">
                                    <font>
                                        <Font name="System Bold" size="11.0" />
                                    </font>
                                </Label>
                                <TextField fx:id="studentIndexField" promptText="6 cyfr (np. 123456)" styleClass="modern-field" />
                            </VBox>

                            <Label styleClass="info-note" text="Student będzie dodany bez grupy. Przypisanie do grupy możliwe w oknie szczegółów grupy.">
                                <font>
                                    <Font size="10.0" />
                                </font>
                            </Label>
                        </VBox>

                        <Button fx:id="addStudentGlobalButton" mnemonicParsing="false" onAction="#onAddStudentGlobalClick"
                                styleClass="primary-button" text="Dodaj studenta" maxWidth="Infinity" />
                    </VBox>

                    <!-- ========== NOWA KARTA - ZARZĄDZANIE STUDENTAMI ========== -->
                    <!-- Student Management Card -->
                    <VBox fx:id="studentManagementCard" alignment="TOP_CENTER" spacing="20.0" styleClass="main-card" maxWidth="350.0" minWidth="300.0">
                        <padding>
                            <Insets bottom="25.0" left="25.0" right="25.0" top="25.0" />
                        </padding>

                        <HBox alignment="CENTER_LEFT" spacing="10.0">
                            <Label styleClass="card-title" text="Zarządzaj studentami">
                                <font>
                                    <Font name="System Bold" size="16.0" />
                                </font>
                            </Label>
                            <Region HBox.hgrow="ALWAYS" />
                            <Button fx:id="refreshAllStudentsButton" mnemonicParsing="false" onAction="#onRefreshAllStudentsClick"
                                    styleClass="secondary-button" text="🔄" />
                        </HBox>

                        <!-- Licznik wszystkich studentów -->
                        <Label fx:id="allStudentsCountLabel" styleClass="count-label" text="Ładowanie studentów...">
                            <font>
                                <Font size="10.0" />
                            </font>
                        </Label>

                        <!-- Sekcja wyszukiwania studenta -->
                        <VBox spacing="10.0" styleClass="form-container">
                            <VBox spacing="5.0">
                                <Label styleClass="field-label" text="Znajdź studenta po numerze indeksu:">
                                    <font>
                                        <Font name="System Bold" size="11.0" />
                                    </font>
                                </Label>
                                <TextField fx:id="searchStudentField" promptText="Wpisz nr indeksu (6 cyfr)" styleClass="modern-field" />
                            </VBox>

                            <Button fx:id="searchStudentButton" mnemonicParsing="false" onAction="#onSearchStudentClick"
                                    styleClass="secondary-button" text="🔍 Znajdź studenta" maxWidth="Infinity" />
                        </VBox>

                        <!-- Informacje o znalezionym studencie -->
                        <VBox fx:id="foundStudentInfo" spacing="10.0" styleClass="info-note" visible="false" managed="false">
                            <Label fx:id="foundStudentNameLabel" styleClass="field-label" text="" />
                            <Label fx:id="foundStudentGroupLabel" styleClass="field-label" text="" />
                            <Label fx:id="foundStudentDateLabel" styleClass="field-label" text="" />

                            <!-- Przyciski akcji dla znalezionego studenta -->
                            <HBox spacing="10.0" alignment="CENTER">
                                <Button fx:id="editFoundStudentButton" mnemonicParsing="false" onAction="#onEditFoundStudentClick"
                                        styleClass="secondary-button" text="✏️ Edytuj" />
                                <Button fx:id="removeFoundStudentButton" mnemonicParsing="false" onAction="#onRemoveFoundStudentClick"
                                        styleClass="danger-button" text="🗑️ Usuń" />
                            </HBox>
                        </VBox>

                        <!-- Lista ostatnio dodanych studentów -->
                        <Separator />
                        <VBox spacing="8.0">
                            <Label styleClass="field-label" text="Ostatnio dodani studenci:">
                                <font>
                                    <Font name="System Bold" size="11.0" />
                                </font>
                            </Label>

                            <ListView fx:id="recentStudentsListView" styleClass="modern-list"
                                      maxHeight="120.0" minHeight="80.0" />

                            <Button fx:id="manageAllStudentsButton" mnemonicParsing="false" onAction="#onManageAllStudentsClick"
                                    styleClass="primary-button" text="📋 Zarządzaj wszystkimi" maxWidth="Infinity" />
                        </VBox>

                        <Label styleClass="info-note" text="Użyj wyszukiwania aby znaleźć konkretnego studenta lub otwórz pełny panel zarządzania.">
                            <font>
                                <Font size="9.0" />
                            </font>
                        </Label>
                    </VBox>
                    <!-- ========== KONIEC NOWEJ KARTY ========== -->

                    <!-- Groups List Card -->
                    <VBox fx:id="groupsCard" alignment="TOP_CENTER" spacing="20.0" styleClass="main-card"
                          maxWidth="400.0" minWidth="350.0" VBox.vgrow="ALWAYS">
                        <padding>
                            <Insets bottom="25.0" left="25.0" right="25.0" top="25.0" />
                        </padding>

                        <HBox alignment="CENTER_LEFT" spacing="10.0">
                            <Label styleClass="card-title" text="Lista grup">
                                <font>
                                    <Font name="System Bold" size="16.0" />
                                </font>
                            </Label>
                            <Region HBox.hgrow="ALWAYS" />
                            <Button fx:id="refreshButton" mnemonicParsing="false" onAction="#onRefreshClick"
                                    styleClass="secondary-button" text="Odśwież z serwera" />
                            <!-- ========== DODANY PRZYCISK DIAGNOSTYKI (POPRAWKA 4) ========== -->
                            <Button fx:id="diagnoseButton" mnemonicParsing="false" onAction="#onDiagnoseGroupAPI"
                                    styleClass="secondary-button" text="🔧 Diagnoza API" />
                            <!-- ============================================================== -->
                            <Label fx:id="groupCountLabel" styleClass="count-label" text="Liczba grup: 0">
                                <font>
                                    <Font size="11.0" />
                                </font>
                            </Label>
                        </HBox>

                        <!-- Status serwera -->
                        <HBox alignment="CENTER_LEFT" spacing="10.0">
                            <Label fx:id="serverStatusLabel" styleClass="server-status" text="🔄 Sprawdzanie serwera...">
                                <font>
                                    <Font size="10.0" />
                                </font>
                            </Label>
                        </HBox>

                        <ListView fx:id="groupsListView" styleClass="groups-list" VBox.vgrow="ALWAYS"
                                  minHeight="250.0" maxHeight="350.0" />

                        <HBox alignment="CENTER" spacing="15.0" styleClass="action-buttons">
                            <Button fx:id="enterGroupButton" mnemonicParsing="false" onAction="#onEnterGroupClick"
                                    styleClass="primary-button" text="Wejdź do grupy" />
                            <Button fx:id="deleteGroupButton" mnemonicParsing="false" onAction="#onDeleteGroupClick"
                                    styleClass="danger-button" text="Usuń grupę" />
                        </HBox>
                    </VBox>
                </HBox>

                <!-- Info Section -->
                <VBox alignment="CENTER" spacing="15.0" styleClass="info-section" maxWidth="800.0">
                    <Label styleClass="info-title" text="Instrukcja użytkowania">
                        <font>
                            <Font name="System Bold" size="16.0" />
                        </font>
                    </Label>

                    <GridPane alignment="CENTER" hgap="30.0" vgap="15.0" styleClass="instructions-grid">
                        <columnConstraints>
                            <ColumnConstraints hgrow="SOMETIMES" />
                            <ColumnConstraints hgrow="SOMETIMES" />
                            <ColumnConstraints hgrow="SOMETIMES" />
                        </columnConstraints>

                        <VBox alignment="CENTER" spacing="8.0" styleClass="instruction-item" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label styleClass="instruction-number" text="1">
                                <font>
                                    <Font name="System Bold" size="20.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-title" text="Dodaj grupę">
                                <font>
                                    <Font name="System Bold" size="14.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-desc" text="Wypełnij formularz i kliknij 'Dodaj grupę'. Grupa zostanie wysłana na serwer."
                                   textAlignment="CENTER" wrapText="true">
                                <font>
                                    <Font size="12.0" />
                                </font>
                            </Label>
                        </VBox>

                        <VBox alignment="CENTER" spacing="8.0" styleClass="instruction-item" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label styleClass="instruction-number" text="2">
                                <font>
                                    <Font name="System Bold" size="20.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-title" text="Dodaj studenta">
                                <font>
                                    <Font name="System Bold" size="14.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-desc" text="Dodaj studenta bez grupy na serwer. Sprawdź licznik studentów na serwerze."
                                   textAlignment="CENTER" wrapText="true">
                                <font>
                                    <Font size="12.0" />
                                </font>
                            </Label>
                        </VBox>

                        <VBox alignment="CENTER" spacing="8.0" styleClass="instruction-item" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label styleClass="instruction-number" text="3">
                                <font>
                                    <Font name="System Bold" size="20.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-title" text="Zarządzaj grupami">
                                <font>
                                    <Font name="System Bold" size="14.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-desc" text="Wejdź do grupy, usuń ją lub odśwież listę z serwera. Użyj 'Diagnoza API' aby sprawdzić problemy."
                                   textAlignment="CENTER" wrapText="true">
                                <font>
                                    <Font size="12.0" />
                                </font>
                            </Label>
                        </VBox>

                        <VBox alignment="CENTER" spacing="8.0" styleClass="instruction-item" GridPane.columnIndex="0" GridPane.rowIndex="1">
                            <Label styleClass="instruction-number" text="4">
                                <font>
                                    <Font name="System Bold" size="20.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-title" text="Wyszukaj studenta">
                                <font>
                                    <Font name="System Bold" size="14.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-desc" text="Użyj nowej karty 'Zarządzaj studentami' aby wyszukać konkretnego studenta po numerze indeksu"
                                   textAlignment="CENTER" wrapText="true">
                                <font>
                                    <Font size="12.0" />
                                </font>
                            </Label>
                        </VBox>

                        <VBox alignment="CENTER" spacing="8.0" styleClass="instruction-item" GridPane.columnIndex="1" GridPane.rowIndex="1">
                            <Label styleClass="instruction-number" text="5">
                                <font>
                                    <Font name="System Bold" size="20.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-title" text="Usuń z dodatkowymi polami">
                                <font>
                                    <Font name="System Bold" size="14.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-desc" text="Po znalezieniu studenta użyj przycisku 'Usuń' aby otworzyć dialog z powodami i uwagami"
                                   textAlignment="CENTER" wrapText="true">
                                <font>
                                    <Font size="12.0" />
                                </font>
                            </Label>
                        </VBox>

                        <VBox alignment="CENTER" spacing="8.0" styleClass="instruction-item" GridPane.columnIndex="2" GridPane.rowIndex="1">
                            <Label styleClass="instruction-number" text="6">
                                <font>
                                    <Font name="System Bold" size="20.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-title" text="Diagnoza problemów">
                                <font>
                                    <Font name="System Bold" size="14.0" />
                                </font>
                            </Label>
                            <Label styleClass="instruction-desc" text="Użyj przycisku 'Diagnoza API' aby sprawdzić połączenie z serwerem i zdiagnozować problemy z usuwaniem grup"
                                   textAlignment="CENTER" wrapText="true">
                                <font>
                                    <Font size="12.0" />
                                </font>
                            </Label>
                        </VBox>
                    </GridPane>
                </VBox>
            </VBox>
        </ScrollPane>
    </center>

    <!-- Footer -->
    <bottom>
        <HBox alignment="CENTER" styleClass="footer">
            <padding>
                <Insets bottom="15.0" left="20.0" right="20.0" top="15.0" />
            </padding>
            <Label styleClass="footer-text" text="Dziennik Online • System zarządzania grupami • 2024 • Synchronizacja z serwerem • Zaawansowane zarządzanie studentami • Diagnostyka API">
                <font>
                    <Font size="12.0" />
                </font>
            </Label>
        </HBox>
    </bottom>
</BorderPane>